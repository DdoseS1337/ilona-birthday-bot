# üéÇ Ilona Birthday Bot

–£–∫—Ä–∞—ó–Ω—Å—å–∫–∏–π Telegram –±–æ—Ç, —Å—Ç–≤–æ—Ä–µ–Ω–∏–π –Ω–∞ NestJS —Ç–∞ Telegraf, —è–∫–∏–π –≤–µ–¥–µ –ø—ñ–¥—Ä–∞—Ö—É–Ω–æ–∫ –¥–Ω—ñ–≤ –¥–æ –¥–Ω—è –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è —Ç–∞ –Ω–∞–¥—Å–∏–ª–∞—î —â–æ–¥–µ–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫–æ–º. –í –¥–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è –Ω–∞–¥—Å–∏–ª–∞—î –æ—Å–æ–±–ª–∏–≤–µ –ø—Ä–∏–≤—ñ—Ç–∞–Ω–Ω—è —Ç–∞ –æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ GIF!

## ‚ú® –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ

- üéâ **–©–æ–¥–µ–Ω–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫–æ–º**: –ù–∞–¥—Å–∏–ª–∞—î –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫–æ–º —â–æ–¥–Ω—è
- üéÇ **–°–≤—è—Ç–∫—É–≤–∞–Ω–Ω—è –¥–Ω—è –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è**: –û—Å–æ–±–ª–∏–≤–µ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —Ç–∞ GIF –≤ –¥–µ–Ω—å –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è
- ‚öôÔ∏è **–ü–æ–≤–Ω—ñ—Å—Ç—é –Ω–∞–ª–∞—à—Ç–æ–≤—É–≤–∞–Ω–æ**: –ù–∞–ª–∞—à—Ç—É–π –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è, –¥–∞—Ç—É –Ω–∞—Ä–æ–¥–∂–µ–Ω–Ω—è, —á–∞—Å–æ–≤–∏–π –ø–æ—è—Å —Ç–∞ –±–∞–≥–∞—Ç–æ —ñ–Ω—à–æ–≥–æ
- ü§ñ **–Ü–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è –∑ Telegram**: –°—Ç–≤–æ—Ä–µ–Ω–∏–π –Ω–∞ Telegraf –¥–ª—è –±–µ–∑—à–æ–≤–Ω–æ—ó —Ä–æ–±–æ—Ç–∏ –∑ Telegram
- üìÖ **–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î node-cron –¥–ª—è –Ω–∞–¥—ñ–π–Ω–æ–≥–æ —â–æ–¥–µ–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è
- üåç **–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ —á–∞—Å–æ–≤–∏—Ö –ø–æ—è—Å—ñ–≤**: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î Luxon DateTime –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ —á–∞—Å—É –≤ —Ä—ñ–∑–Ω–∏—Ö —á–∞—Å–æ–≤–∏—Ö –ø–æ—è—Å–∞—Ö
- üé® **–í–∏–ø–∞–¥–∫–æ–≤—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è**: –û–±–µ—Ä—Ç–∞—î —Ä—ñ–∑–Ω—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ –ø—ñ–¥—Ä–∞—Ö—É–Ω–∫–æ–º –¥–ª—è —Ä—ñ–∑–Ω–æ–º–∞–Ω—ñ—Ç–Ω–æ—Å—Ç—ñ
- üîç **–ê–≤—Ç–æ–≤–∏–∑–Ω–∞—á–µ–Ω–Ω—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–∑–Ω–∞—á–∞—î ID —á–∞—Ç—É –ø—Ä–∏ –¥–æ–¥–∞–≤–∞–Ω–Ω—ñ –¥–æ –∫–∞–Ω–∞–ª—ñ–≤/–≥—Ä—É–ø
- üöÄ **–ü—Ä–æ—Å—Ç–∏–π –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è**: –ù–µ –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ä—É—á–Ω–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è ID —á–∞—Ç—É!
- üëã **–ì—Ä–∞–π–ª–∏–≤–∏–π —Å—Ç–∏–ª—å**: –í—Å—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø–æ—á–∏–Ω–∞—é—Ç—å—Å—è –∑ "–ü—Ä–∏–≤—ñ—Ç, –ª–µ–¥—ñ!" —Ç–∞ –Ω–∞–ø–∏—Å–∞–Ω—ñ –≤ –≥—Ä–∞–π–ª–∏–≤–æ–º—É —Å—Ç–∏–ª—ñ

## üöÄ Quick Start

### Prerequisites

- Node.js (v16 or higher)
- pnpm (or npm)
- A Telegram bot token (get one from [@BotFather](https://t.me/botfather))

### Installation

1. **Clone and install dependencies:**
   ```bash
   git clone <your-repo-url>
   cd ilona-birthday-bot
   pnpm install
   ```

2. **Create environment file:**
   ```bash
   # Option 1: Use the setup script
   pnpm run setup
   
   # Option 2: Manual copy
   cp env.example .env
   ```

3. **Configure your bot:**
   Edit `.env` file with your settings:
   ```env
   # Telegram Bot Configuration
   TELEGRAM_BOT_TOKEN=your_telegram_bot_token_here
   TELEGRAM_CHAT_ID=your_chat_id_here

   # Birthday Configuration
   BIRTHDAY_NAME=Ilona
   BIRTHDAY_DATE=12-25
   TIMEZONE=UTC

   # Custom Messages (separated by |)
   DAILY_MESSAGES=üéâ Only {days} days until {name}'s birthday!|‚è∞ {days} days left until the big day!|üéÇ The countdown continues: {days} days to go!

   # Birthday Message
   BIRTHDAY_MESSAGE=üéâüéÇ HAPPY BIRTHDAY {name}! üéÇüéâ\n\nWishing you an amazing day filled with joy, laughter, and all your favorite things! üéÅ‚ú®

   # Optional: Birthday GIF URL
   BIRTHDAY_GIF_URL=https://media.giphy.com/media/your-gif-url-here.gif
   ```

### Getting Your Telegram Bot Token

1. Message [@BotFather](https://t.me/botfather) on Telegram
2. Send `/newbot` and follow the instructions
3. Copy the bot token to your `.env` file

### Getting Your Chat ID (Optional)

The bot can now automatically detect the chat ID when you add it to a channel or group! However, if you want to set it manually:

1. Add your bot to a group or start a private chat
2. Send a message to the bot
3. Visit: `https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates`
4. Look for the `chat.id` in the response

**Auto-detection**: Simply add the bot to your desired channel/group and it will automatically start sending messages there!

## üîç Auto-Detection Feature

The bot now automatically detects when it's added to a channel or group:

1. **Add the bot** to your desired channel/group
2. **Bot automatically detects** the chat ID
3. **Welcome message** is sent with current countdown
4. **Daily messages** start automatically at 12 PM

### How it works:
- When you add the bot to a channel/group, it detects the chat ID
- The bot sends a welcome message with the current countdown
- Daily scheduled messages will be sent to this chat automatically
- No manual configuration needed!

### Running the Bot

```bash
# Development mode
pnpm run start:dev

# Production mode
pnpm run build
pnpm run start:prod
```

## üéõÔ∏è Configuration Options

### Environment Variables

| Variable | Description | Default | Example |
|----------|-------------|---------|---------|
| `TELEGRAM_BOT_TOKEN` | Your Telegram bot token | Required | `123456789:ABCdefGHIjklMNOpqrsTUVwxyz` |
| `TELEGRAM_CHAT_ID` | Chat ID to send messages to | Optional (auto-detected) | `-1001234567890` |
| `BIRTHDAY_NAME` | Name of the birthday person | `Ilona` | `John` |
| `BIRTHDAY_DATE` | Birthday date (MM-DD format) | `12-25` | `03-15` |
| `TIMEZONE` | Timezone for scheduling | `Europe/Kyiv` | `America/New_York` |
| `DAILY_MESSAGES` | Custom countdown messages (separated by \|) | Default messages | `Message 1\|Message 2` |
| `BIRTHDAY_MESSAGE` | Special birthday message | Default message | `Happy Birthday {name}!` |
| `BIRTHDAY_GIF_URL` | Optional GIF URL for birthday | None | `https://giphy.com/gif/...` |

### Message Templates

Use these placeholders in your messages:
- `{name}` - Replaced with the birthday person's name
- `{days}` - Replaced with the number of days remaining

## üéÆ Bot Commands

- `/start` - Welcome message and bot introduction
- `/countdown` - Check current countdown status
- `/help` - Show available commands

## üåê API Endpoints

The bot also provides HTTP endpoints for monitoring:

- `GET /` - Basic health check
- `GET /countdown` - Get current countdown information
- `POST /send-countdown` - Manually trigger countdown message
- `GET /health` - Detailed health status
- `GET /chat-id` - Check current chat ID status
- `POST /set-chat-id` - Manually set chat ID

## üìÖ Scheduling

- **Daily Messages**: Sent at 12:00 PM (noon) in the configured timezone
- **Hourly Messages**: When less than 24 hours remain, messages sent every hour
- **10-Minute Messages**: In the last hour, messages sent every 10 minutes
- **Birthday Message**: Sent at exactly 00:01 on the birthday date
- **Timezone Support**: Configure any timezone using standard timezone names

### üéØ Smart Countdown Logic:
- **Days > 1**: Daily messages at 12 PM
- **Last 24 hours**: Hourly countdown messages
- **Last hour**: Every 10 minutes with special messages
- **00:01**: Exact birthday celebration message

### ‚è∞ DateTime Features:
- **Luxon Integration**: Uses Luxon DateTime for precise timezone handling
- **Timezone Support**: All calculations respect the configured timezone
- **Accurate Scheduling**: Cron jobs run in the correct timezone
- **Flexible Scheduling**: Can schedule messages at specific DateTime instances

## üõ†Ô∏è Development

### Project Structure

```
src/
‚îú‚îÄ‚îÄ birthday-bot.service.ts # Main bot service
‚îú‚îÄ‚îÄ app.controller.ts      # HTTP endpoints
‚îú‚îÄ‚îÄ app.module.ts         # Main app module
‚îú‚îÄ‚îÄ app.service.ts        # App service
‚îî‚îÄ‚îÄ main.ts              # Application entry point
```

### Available Scripts

```bash
# Development
pnpm run start:dev

# Build
pnpm run build

# Production
pnpm run start:prod

# Linting
pnpm run lint

# Testing
pnpm run test
pnpm run test:e2e
```

## üé® Customization Examples

### Custom Daily Messages
```env
DAILY_MESSAGES=üéâ Only {days} days until {name}'s birthday!|‚è∞ {days} days left until the big day!|üéÇ The countdown continues: {days} days to go!|üéà {days} more days until {name}'s special day!|üéä Time is flying! Only {days} days left!
```

### Custom Birthday Message
```env
BIRTHDAY_MESSAGE=üéâüéÇ HAPPY BIRTHDAY {name}! üéÇüéâ\n\nWishing you an amazing day filled with joy, laughter, and all your favorite things! üéÅ‚ú®
```

### Different Timezone
```env
TIMEZONE=America/New_York
```

## üöÄ Deployment

### Using PM2
```bash
# Install PM2
npm install -g pm2

# Build the project
pnpm run build

# Start with PM2
pm2 start dist/main.js --name "birthday-bot"

# Save PM2 configuration
pm2 save
pm2 startup
```

### Using Docker
```dockerfile
FROM node:18-alpine
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build
EXPOSE 3000
CMD ["npm", "run", "start:prod"]
```

## ü§ù Contributing

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## üìù License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üéÇ Happy Birthday!

Enjoy your automated birthday countdown bot! üéâ